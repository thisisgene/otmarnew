var express=require("express"),router=express.Router(),marked=require("marked"),mongoose=require("mongoose"),Project=mongoose.model("Project");router.get("/",function(e,r,n){Project.find(function(e,n){r.render("admin/index",{title:"Admin",projects:n})})}),router.post("/create_project",function(e,r){var n=e.body.name;console.log(n),new Project({name:n,deleted:!1}).save(function(e,n){e||r.send(n._id)})}),router.post("/create_sub_project",function(e,r){var n=e.body.name,o=e.body.parentId;Project.findById(o,function(e,t){if(e)console.log(e);else{var d=new Project({name:n,deleted:!1,hasParent:!0,parentId:o,parentName:t.name});d.save(),console.log(t),t.children.push(d._id),t.hasChildren=!0,t.save(function(e,n){r.send("success")})}})}),router.get("/delete/:id",function(e,r){var n=e.params.id;Project.findById(n,function(e,n){n.deleted=!0,n.save(function(e,n){r.redirect("/admin")})})}),router.get("/project/:id",function(e,r,n){Project.find(function(n,o){r.render("admin/index",{title:"Admin",projects:o,currentProjectId:e.params.id})})}),router.post("/save_all",function(e,r){var n=e.body,o=n.id,t=n.description,d=marked(t);Project.findById(o,function(e,n){n.descMU=t,n.descHtml=d,n.save(function(e){e?r.send(e):r.send("success")})})}),module.exports=router;